<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>聊天机器人示例</title>
</head>
<body>
  <h2>欢迎使用聊天机器人</h2>
  <p>请在右下角对话框输入内容试试看。</p>

  <!-- ✅ 嵌入 tawk.to -->
 <script type="text/javascript">
  var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();

  (function () {
    var s1 = document.createElement("script"),
      s0 = document.getElementsByTagName("script")[0];
    s1.async = true;
    s1.src = 'https://embed.tawk.to/你的ID/你的WidgetID';  // ✅ 替换为你的 ID
    s1.charset = 'UTF-8';
    s1.setAttribute('crossorigin', '*');
    s0.parentNode.insertBefore(s1, s0);
  })();

  Tawk_API.onMessageVisitor = function (msgObj) {
    const messageText = msgObj.text || "";  // ✅ 获取访客发来的文本消息
    console.log("收到访客消息:", messageText);

    fetch("http://3.71.28.18:5000/chatbot", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ question: messageText })  // ✅ 正确使用 messageText
    })
    .then(res => res.json())
    .then(data => {
      console.log("机器人回复:", data.answer);

      if (Tawk_API && typeof Tawk_API.say === "function") {
        Tawk_API.say(data.answer);  // ✅ 自动回复访客
      }

      // 可选记录事件
      Tawk_API.addEvent('机器人自动回复', {
        description: data.answer
      });
    })
    .catch(error => console.error("机器人错误:", error));
  };
</script>
</body>
</html>
