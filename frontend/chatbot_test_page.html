<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>客户-客服聊天模拟测试</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; height: 100vh; margin: 0; }
  .chat-panel { flex: 1; border: 1px solid #ccc; display: flex; flex-direction: column; margin: 10px; }
  .header { background: #007bff; color: white; padding: 10px; }
  .messages { flex: 1; padding: 10px; overflow-y: auto; background: #f9f9f9; }
  .input-area { display: flex; padding: 10px; background: #eee; }
  input[type="text"] { flex: 1; padding: 8px; font-size: 14px; }
  button { margin-left: 10px; padding: 8px 16px; font-size: 14px; }
  .msg { margin-bottom: 10px; }
  .msg.client { color: #007bff; }
  .msg.agent { color: #28a745; }
</style>
</head>
<body>

<div class="chat-panel" id="clientPanel">
  <div class="header">客户界面</div>
  <div class="messages" id="clientMessages"></div>
  <div class="input-area">
    <input type="text" id="clientInput" placeholder="客户输入消息..." />
    <button onclick="sendClientMessage()">发送</button>
  </div>
</div>

<div class="chat-panel" id="agentPanel">
  <div class="header">客服界面</div>
  <div class="messages" id="agentMessages"></div>
  <div class="input-area">
    <input type="text" id="agentInput" placeholder="客服输入消息..." />
    <button onclick="sendAgentMessage()">发送</button>
  </div>
</div>

<script>
  const clientMessages = document.getElementById('clientMessages');
  const agentMessages = document.getElementById('agentMessages');
  const clientInput = document.getElementById('clientInput');
  const agentInput = document.getElementById('agentInput');

  // 客户发消息，调用后端 /chat
  async function sendClientMessage() {
    const msg = clientInput.value.trim();
    if (!msg) return;

    // 客户界面显示原始法语
    appendMessage(clientMessages, msg, 'client');
    clientInput.value = '';

    try {
      const res = await fetch('http://3.71.28.18:5000/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg })
      });
      const data = await res.json();
      // 客服界面显示翻译后的中文
      appendMessage(agentMessages, data.reply_zh, 'client');
      // 客户界面显示法语回复（机器人回复）
      appendMessage(clientMessages, data.reply_fr, 'agent');
    } catch (e) {
      appendMessage(agentMessages, '翻译失败', 'client');
      appendMessage(clientMessages, '翻译失败', 'agent');
    }
  }

  // 客服发消息，调用后端 /agent
  async function sendAgentMessage() {
    const msg = agentInput.value.trim();
    if (!msg) return;

    // 客服界面显示原始中文
    appendMessage(agentMessages, msg, 'agent');
    agentInput.value = '';

    try {
      const res = await fetch('http://3.71.28.18:5000/agent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg })
      });
      const data = await res.json();
      // 客户界面显示法语翻译
      appendMessage(clientMessages, data.reply, 'client');
    } catch (e) {
      appendMessage(clientMessages, '翻译失败', 'client');
    }
  }

  // 显示消息
  function appendMessage(container, msg, sender) {
    const div = document.createElement('div');
    div.className = 'msg ' + sender;
    div.textContent = msg;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
  }
</script>

</body>
</html>
